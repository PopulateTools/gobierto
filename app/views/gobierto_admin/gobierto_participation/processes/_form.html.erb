<%= render 'gobierto_admin/shared/validation_errors', resource: @process_form %>

<%= form_for(@process_form, as: :process, url: @process_form.persisted? ? admin_participation_process_path(@process_form) : admin_participation_processes_path, data: { 'globalized-form-container' => true }) do |f| %>

    <div class="globalized_fields">
      <%= render "gobierto_admin/shared/form_locale_switchers" %>

      <% I18n.available_locales.map(&:to_s).each do |locale| %>
        <div class="form_item input_text" data-locale="<%= locale %>">
          <%= label_tag "process[title_translations][#{locale}]", f.object.class.human_attribute_name(:title) %>
          <%= text_field_tag "process[title_translations][#{locale}]", f.object.title_translations && f.object.title_translations[locale], placeholder: t(".placeholders.title") %>
        </div>

        <div class="form_item textarea" data-locale="<%= locale %>">
          <%= label_tag "process[body_translations][#{locale}]", f.object.class.human_attribute_name(:body) %>
          <%= text_area_tag "process[body_translations][#{locale}]", f.object.body_translations && f.object.body_translations[locale], placeholder: t(".placeholders.body") %>
        </div>

        <div class="form_item textarea" data-locale="<%= locale %>">
          <%= label_tag "process[information_text_translations][#{locale}]", f.object.class.human_attribute_name(:information_text) %>
          <%= text_area_tag "process[information_text_translations][#{locale}]", f.object.information_text_translations && f.object.information_text_translations[locale], placeholder: t(".placeholders.information_text") %>
        </div>
      <% end %>
    </div>

    <div class="form_item input_text">
      <%= f.label :slug %>
      <%= f.text_field :slug, placeholder: t(".placeholders.slug") %>
    </div>

    <div class="form_item file_field">
      <%= f.label :header_image, 'Imagen de cabecera' %>

      <% if f.object.header_image_url.present? %>
        <%= image_tag f.object.header_image_url, height: 150 %>
      <% end %>

      <%= f.file_field :header_image %>
    </div>

    <div class="pure-g">

      <div class="pure-u-1 pure-u-md-1-2 p_h_r_1">

        <div class="form_item select_control">
          <label for="entity">Tema</label>
          <%= f.select(:issue_id, @issues, { include_blank: '-' }) %>
        </div>

      </div>

      <div class="pure-u-1 pure-u-md-1-2 ">

        <div class="form_item select_control">
          <label for="entity">Ámbito</label>
          <select>
            <option>Centro</option>
            <option>Polígonos</option>
            <option>Valdelasfuentes</option>
            <option>Urbanizaciones</option>
          </select>
        </div>

      </div>

    </div>

    <div class="pure-g">
      <div class="pure-u-1 pure-u-md-1-2 p_h_r_1">
        <div class="form_item input_text">
          <%= f.label :starts %>
          <%= f.text_field :starts, data: {
              "language": I18n.locale,
              "date-format": "yyyy-mm-dd",
              "startDate": format_time(f, :starts)
            },
            class: "air-datepicker",
            readonly: !Rails.env.test?
          %>
        </div>
      </div>

      <div class="pure-u-1 pure-u-md-1-2">
        <div class="form_item input_text">
          <%= f.label :ends %>
          <%= f.text_field :ends, data: {
              "language": I18n.locale,
              "date-format": "yyyy-mm-dd",
              "startDate": format_time(f, :ends, 2)
            },
            class: "air-datepicker",
            readonly: !Rails.env.test?
          %>
        </div>
      </div>
    </div>

    <div class="form_block">

      <div class="form_item">

        <div id="process_type_radio_buttons" class="options compact">

          <h3><%= t('.process_type') %></h3>

          <% GobiertoParticipation::Process.process_types.keys.each do |type| %>
            <div class="option">
              <%= f.radio_button :process_type, type %>
              <%= f.label :process_type, value: type do %>
                <span></span>
                <%= translate_enum_value(GobiertoParticipation::Process, :process_type, type) %>
              <% end %>
            </div>
          <% end %>

        </div>

      </div>

    </div>

    <div class="form_block">
      <h3><%= t('.stages_and_tools') %></h3>

      <ul class="block_list">
        <%= f.fields_for :stages, f.object.default_stages do |stage_form| %>

          <!-- Edit popup trigger -->
          <div class="list_item">
            <label class="main"><%= translate_enum_value(GobiertoParticipation::ProcessStage, :stage_type, stage_form.object.stage_type) %></label>

            <div class="mandatory">
              <%= stage_form.check_box :active %> Active
            </div>
            <div class="tools">
              <%= link_to '<i class="fa fa-edit"></i>'.html_safe, "#edit_stage_#{stage_form.index}", title: 'Editar', class: 'tipsit open_modal' %>
            </div>
          </div>
          <!-- ./ Edit popup trigger -->

          <!-- Edit popup -->
          <div class="modal mfp-hide" id="<%= "edit_stage_#{stage_form.index}" %>">

            <h2>Editar fase: <%= stage_form.object.stage_type %></h2>

            <div class="globalized_fields">

              <%= render "gobierto_admin/shared/form_locale_switchers" %>

              <%= stage_form.hidden_field :stage_type %>

              <% I18n.available_locales.map(&:to_s).each do |locale| %>
                <div class="form_item input_text" data-locale="<%= locale %>">
                  <%= label_tag "process[stages_attributes][#{stage_form.index}][title_translations][#{locale}]", stage_form.object.class.human_attribute_name(:title) %>
                  <%= text_field_tag "process[stages_attributes][#{stage_form.index}][title_translations][#{locale}]", stage_form.object.title_translations && stage_form.object.title_translations[locale], placeholder: t(".placeholders.process_stage.title") %>
                </div>

                <div class="form_item input_text" data-locale="<%= locale %>">
                  <%= label_tag "process[stages_attributes][#{stage_form.index}][description_translations][#{locale}]", stage_form.object.class.human_attribute_name(:description) %>
                  <%= text_area_tag "process[stages_attributes][#{stage_form.index}][description_translations][#{locale}]", stage_form.object.description_translations && stage_form.object.description_translations[locale], placeholder: t(".placeholders.process_stage.description") %>
                </div>
              <% end %>

              <div class="pure-g">
                <div class="pure-u-1 pure-u-md-1-2 p_h_r_1">
                  <div class="form_item input_text">
                    <%= stage_form.label :starts %>
                    <%= stage_form.text_field :starts, data: {
                        "language": I18n.locale,
                        "date-format": "yyyy-mm-dd",
                        "startDate": format_time(stage_form, :starts)
                      },
                      class: "air-datepicker",
                      readonly: !Rails.env.test?
                    %>
                  </div>
                </div>

                <div class="pure-u-1 pure-u-md-1-2">
                  <div class="form_item input_text">
                    <%= stage_form.label :ends %>
                    <%= stage_form.text_field :ends, data: {
                        "language": I18n.locale,
                        "date-format": "yyyy-mm-dd",
                        "startDate": format_time(stage_form, :ends)
                      },
                      class: "air-datepicker",
                      readonly: !Rails.env.test?
                    %>
                  </div>
                </div>
              </div>

            </div>

          </div>
          <!-- ./ Edit popup -->
        <% end %>

      </ul>

    </div>

    <div class="pure-u-1 pure-u-md-1-4 ">

      <div class="widget_save stick_in_parent">
        <%= f.submit class: "button" %>
      </div>

    </div>

<% end %>
