<div class="admin_breadcrumb">
  <%= link_to t("gobierto_admin.welcome.index.title"), admin_root_path %> Â»
  <%= t(".title") %>
</div>

<h1><%= t(".title") %></h1>

<div class="pure-g">

  <div class="pure-u-1 pure-u-md-1-2 p_h_r_2">

    <h3><%= t(".latest_editions") %></h3>

    <div class="activity_feed">
      <% @pages.each do |page| %>
        <div class="activity_item">
          <h2>
            <%= link_to edit_admin_cms_page_path(page, collection_id: page.collection) do %>
              <%= page.title %>
              <span class="secondary">
                <%= truncate(strip_tags(page.body), length: 60, escape: false) %>
              </span>
            <% end %>
          </h2>
          <div class="date">
            <%= l(page.published_on, format: :short) %>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <div class="pure-u-1 pure-u-md-1-2">

    <div class="pure-g">

      <div class="pure-u-1-2">
        <h3 class="m_t_0"><%= t('.sections') %></h3>
      </div>

      <div class="pure-u-1-2 admin_tools right" id="new-section">
        <%= link_to t(".new"), new_admin_cms_section_path, class: 'button open_remote_modal', data: { "globalized-form-container" => true } %>
      </div>

    </div>

    <table class="m_b_3" id="sections">
      <tr>
        <th><%= t('.header.section') %></th>
        <th><%= t('.header.pages') %></th>
        <th></th>
      </tr>

      <% @sections.each do |section| %>
        <tr>
          <td>
            <%= link_to section.title, admin_cms_section_path(section) %>
          </td>
          <td>
            <%= section.section_items.size %>
          </td>
          <td>
            <% unless section.section_items.empty? %>
              <%= link_to gobierto_cms_section_path(section.slug), target: "_blank", class: "view_item" do %>
                <i class="fas fa-eye"></i>
                <%= t(".view_section") %>
              <% end %>
            <% end %>
          </td>
        </tr>
      <% end %>
    </table>

    <div class="pure-g">
      <div class="pure-u-1-2">
        <h3><%= t(".collections") %></h3>
      </div>
      <div class="pure-u-1-2 admin_tools right" id="new-page">
        <%= link_to t(".new"), new_admin_common_collection_path(item_type: 'Page'), class: 'button open_remote_modal', data: { "globalized-form-container" => true } %>
      </div>
    </div>

    <table class="m_b_3">
      <tr>
        <th></th>
        <th><%= t(".header.collection") %></th>
        <th><%= t(".header.pages") %></th>
        <th></th>
        <th></th>
      </tr>

      <tbody>
        <% @collections.each do |collection| %>
          <% next unless collection.container.present? %>
          <tr id="collection-item-<%= collection.id %>">
            <td>
              <%= link_to edit_admin_common_collection_path(collection, item_type: 'Page'), class: 'open_remote_modal' do %>
                <i class="fas fa-edit"></i>
              <% end %>
            </td>
            <td><%= link_to collection.title, admin_common_collection_path(collection) %> (<%= collection_context(collection) %>)</td>
            <td><%= ::GobiertoCms::Page.where(id: collection.pages_or_news_in_collection).size %></td>
            <td>
              <%= link_to new_admin_cms_page_path(collection_id: collection.id), target: "_blank", class: "view_item" do %>
                <i class='fas fa-plus-circle'></i><%= t('.add_new') %> <%= collection.item_type.include?("News") ? t('activerecord.models.gobierto_cms/news') : t('activerecord.models.gobierto_cms/page') %>
              <% end %>
            </td>
            <td>
              <%= link_to gobierto_cms_pages_path(collection.slug), target: "_blank", class: "view_item" do %>
                <i class="fas fa-eye"></i>
                <%= t(".view_collection") %>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

</div>
